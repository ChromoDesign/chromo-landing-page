---
import { Icon } from "./icon";
import MoonIcon from "@/assets/icons/dark-mode.svg?raw";
import SunIcon from "@/assets/icons/light-mode.svg?raw";
---

<label class="relative inline-block cursor-pointer">
  <input type="checkbox" id="theme-toggle" class="sr-only" />
  <span
    class="relative block h-10 w-20 rounded-full border-[1px] border-[#474747] bg-transparent shadow-md transition-all"
  >
    <span
      id="sun-icon"
      class="absolute left-2 top-1/2 -translate-y-1/2 transform transition-opacity duration-300"
    >
      <Icon icon={SunIcon} className="h-6 w-6" />
    </span>

    <span
      id="moon-icon"
      class="absolute right-1.5 top-1/2 -translate-y-1/2 transform transition-opacity duration-300"
    >
      <Icon icon={MoonIcon} className="h-6 w-6" />
    </span>

    <span
      id="toggle-circle"
      class="absolute top-0 block h-10 w-10 -translate-y-1/2 transform rounded-full border-[1px] border-[#474747] shadow-sm transition-transform duration-300"
    ></span>
  </span>
</label>
<script>
  document.addEventListener("DOMContentLoaded", () => {
    const toggleSwitch = document.getElementById(
      "theme-toggle",
    ) as HTMLInputElement;
    const htmlElement = document.documentElement;

    const savedTheme = localStorage.getItem("theme");
    const isDarkMode = savedTheme === "dark";

    if (toggleSwitch) {
      toggleSwitch.checked = isDarkMode;
    }

    const sunIcon = document.getElementById("sun-icon");
    const moonIcon = document.getElementById("moon-icon");
    const toggleCircle = document.getElementById("toggle-circle");

    if (sunIcon && moonIcon && toggleCircle) {
      if (isDarkMode) {
        htmlElement.classList.add("dark");
        sunIcon.style.opacity = "20%";
        moonIcon.style.opacity = "100%";
        toggleCircle.style.transform = "translateX(40px)";
      } else {
        htmlElement.classList.remove("dark");
        sunIcon.style.opacity = "100%";
        moonIcon.style.opacity = "20%";
        toggleCircle.style.transform = "translateX(0)";
      }
    }

    if (toggleSwitch) {
      toggleSwitch.addEventListener("change", () => {
        if (toggleSwitch.checked) {
          htmlElement.classList.add("dark");
          localStorage.setItem("theme", "dark");

          if (sunIcon && moonIcon && toggleCircle) {
            sunIcon.style.opacity = "20%";
            moonIcon.style.opacity = "100%";
            toggleCircle.style.transform = "translateX(40px)";
          }
        } else {
          htmlElement.classList.remove("dark");
          localStorage.setItem("theme", "light");

          if (sunIcon && moonIcon && toggleCircle) {
            sunIcon.style.opacity = "100%";
            moonIcon.style.opacity = "20%";
            toggleCircle.style.transform = "translateX(0px)";
          }
        }
      });
    }
  });
</script>
